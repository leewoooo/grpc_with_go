1장 gRPC
===

## gRPC 소개

최신 소프트웨어 애플리케이션은 **독립적으로 실행되는 경우가 거의 없다.** 현대 소프트웨어 시스템은 여러 네트워크 위치에서 실행되고 다양한 프로토콜을 사용한다. 이를 분산 애플리케이션의 구성이라고 볼 수 있다.
> MSA (microservice Architecture) <br> 독릭접이고 자율적(개별로 개발, 배포, 확장되는)이며 비즈니스 중심의 느슨하게 결합된 서비스 모음으로 소프트웨어 애플리케이션을 구축하는 것이다.


마이크로서비스 기반으로 구축되는 시스템은 프로세스 간(또는 서비스 간, 애플리케이션 간) 통신기술을 사용해 네트워크로 연결해야 한다.

프로세스 간 통신은 보통 두가지 방식이 있다.

1. 동기식 요청-응답
2. 비동기적 방식의 이벤트 기반

<br>

### 동기식 요청-응답

동기적 통신 방식은 클라이언트 프로세스가 네트워크에 있는 **서버에게 요청 메세지를 보내고 응답을 기다리는 방식이다.**

<br>

### 비동기 방식의 이벤트 기반

**이벤트 브로커**라는 중개자를 통해 메세지를 비동기적으로 전달하는 방식이다.

<br>

마이크로서비스에서 동기적 요청-응답 스타일의 통신을 구축할 때에는 주로 **Restful** 서비스로 구성을 하는데 서비스를 **HTTP**기반의 네트워크 호출을 통해 액세스되고 상태를 변경할 수 있는 리소스 모임으로 모델링을 한다.

**그러나** 많은 경우 **Restful**서비스는 프로세스 간 통신을 구축할 때 부피가 크고 비효율적이며 에러가 쉽게 발생되기 때문에 **확장성이 높고 느슨하게 결합되는 프로세스 간 통신기술이 종종 요구된다.**

이것이 gRPC의 등장배경이다.

<br>

## gRPC

### IDL

gRPC 애플리케이션을 개발할 때 가장 먼저 해야할 일은 **서스 인터페이스를 정의하는 것이다.**

서비스를 사용하는 방법, 원격으로 호출되는 메서드의 종류, 해당 메서드의 파라미터, 메세지 형식등을 포함한다.

이와 같이 서비스 정의에 사용되는 언어를 **IDL**라고 한다. (IDL은 Interface Definition Language의 약자이다.)

<br>

### Server 및 Client stub 생성

IDL을 사용하여 **서버 스켈레톤이라는 서버 측 코드를 생성할 수 있다.** 저수준의 통신 추상화를 통해 서버 측 로직을 단순화 할 수 있다.

IDL을 통해 클라이언트 측도 비슷하게 **클라이언트 스텁**이라는 코드를 생성할 수 있다. 다양한 프로그래밍 언어에 대한 낮은 수준의 통신을 추상화함으로써 클라이언트 측 통신을 단순화 시킨다.

**IDL에 지정된 메서드는 로컬 함수를 호출하는 것 처럼 쉽게 클라이언트 측에서 원격으로 호출할 수 있다.**

<br>

### 흐름도

<img src = https://user-images.githubusercontent.com/74294325/143033073-4f681040-4bb4-4c92-bcc1-981045ff8c1d.png>

<br>

production.proto라는 **IDL**에 기술하여 서버 측과 클라이언트 측 코드를 생성한다. 이 떄 **꼭 서버와 클라이언트 측의 프로그래밍 언어가 같을 필요는 없다.**

또한 생성된 클라이언트 측과 서버 측은 **HTTP/2** 프로토콜을 이용하여 통신을 한다.

클라이언트의 gRPC 라이브러리는 프로토콜 버퍼를 사용해 원격 프로시저 호출 **프로토콜 버퍼 형식으로 마샬링하고**, HTTP/2를 통해 전송된다.

서버 측에서는 **요청을 언마샬링하고** 각 프로시저 호출은 프로토콜 버퍼에 의해 실행한다.

전송 프로토콜로는 **HTTP/2**를 사용한다.

<br>

## gRPC 장점

### 프로세스 간 통신 효율성

gRPC는 JSON이나 XML과 같은 텍스트 형식을 사용하는 대신 **프로토콜 버퍼 기반 바이너리 프로토콜을 사용해 gRPC 서비스 및 클라이언트와 통신한다.**

HTTP/2 위에 프로토콜 버퍼로 구현되기에 프로세스 간 통신 속도가 매우 빠르다.

<br>

### 간단 명확한 서비스 인터페이스와 스키마

gRPC는 **애플리케이션 개발용 계약 우선** 접근 방식을 권장한다. **서비스 인터페이스를 정의한 후 나중에 세부 사항을 작업한다.**

간단하면서 안정적인 확장 가능한 애플리케이션 개발 경험을 제공한다.
> 애플리케이션 개발용 계약 우선: 서비스 제공을 위한 개발 방식중 하나로, 명세를 먼저 정의하고 개발하는 것을 일컫는다.

<br>

### 엄격한 타입 점검

gRPC 서비스를 정의하고자 프로토콜 버퍼를 사용하기 때문에 gRPC 서비스 계약은 애플리케이션간 통신에 사용할 **데이터 타입을 명확하게 정의한다.**

<br>

### 폴리글랏

gRPC는 **여러 프로그래밍 언어와 작동하도록 설계됐고** 프로토콜 버퍼 기반의 gRPC서비스 정의는 특정 언어에 구애 받지 않는다.
>폴리글랏: 요구사항이나 시스템 성격에 맞는 다양한 언어를 사용해 개발하는 것을 뜻한다.

<br>

### 이중 스트리밍

gRPC는 클라이언트나 서버 측 스트리밍을 기본적으로 지원한다.

스트리밍은 기존의 요청-응답 스타일의 메시징 방식보다 클라이언트 및 서버 측 스트리밍을 구축하는 기능은 기존 RestFul 메시징 스타일에 비해 주요 장점이 된다.

<br>

## gRPC의 단점

### 외부 서비스 부적합

외부 클라이언트에 제공하려는 경우 대부분 외부 사용자는 gRPC가 새롭기 때문에 적합하지 않을 수도 있다.

이러한 점은 노출되는 서비스의 유연성을 방해할 수 있다. 하지만 **gRPC게이트웨이**는 이 문제를 해결하기 위해 설계되었다.

<br>

### 서비스 정의의 급격한 변경에 따른 개발 프로세스 복잡성

스키마 수정은 최신 서비스 간 통신 usecase에서 상당히 흔히 볼 수 있다.

gRPC 서비스 정의가 급격하게 변경되면 **일반적으로 클라이언트와 서버 코드 모두 다시 생성해야 한다.**

<br>

### 상대적으로 작은 생태계

gRPC 생태계는 여전히 기존 REST나 HTTP 프로토콜에 비해 상대적으로 작다.


